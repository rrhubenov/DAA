# Решение

Псевдокод:

    1 for i <- 2 to A.length
    2     j <- i
    3     while j > 1 and A[j] < A[j-1]
    4         swap(A[j], A[j-1])
    5         j <- j - 1

Доказателство за коректност:

За да докажем коректностна на тази имплементация на insertion sort
ще използваме инварианти. Тъй като имаме два цикъла ще докажем коректността им
поотделно.

## Доказателство чрез инварианта за while цикъла

Искаме да докажем, че когато while цикълът приключи с последната си итерацията,
A[1..i] ще съдържа i елемента от А, сортирани в ненарастващ ред.

Вход:
    А[1..i-1] сортиран масив

Изход:
    A[1..i] сортиран масив

Инварианта:
                
    A[1..j-1], A[j..i] са сортирани подмасиви

Инициализация:

    Преди първата итерация на while цикъла j = i = 2, А[j..i] е тривиално сортиран тъй като
    съдържа само един елемент. A[1..j-1] е елемента на позиция A[1] следователно е тривиално
    сортиран.
    (Дефинирали сме входа като сортиран масив A[1..i-1] следователно 
    ще бъде вярно за всяка стойност на j = i)

Поддръжка:

    Нека предположим, че A[1..j-1], A[j..i] са сортирани.
    Тъй като итерацията ще се случи, само ако A[j-1] > A[j], размяната на A[j]
    с A[j-1] и декрементирането на j ще има следните последствия върху двата подмасива:
    (Нека А' бъде масива с новата стойност на j)
    1. Тъй като А[j-1] > A[j], А'[j+1] <= A'[j+2] след размяната. Следователно A'[j..i] e сортиран.
    2. A'[1..j-1] продължава да бъде сортиран, тъй като само последния елемент е преместен
    в А'[j..i]

    Следователно инвариантата се запазва след всеки цикъл.

Терминация:

    While цикълът ще терминиране в един от следните два случая:
    1. j = 1 следовадетлно A[1..j-1] е празния ммасив и е тривиално сортиран.
    А[j..i] е целия масив, който е сортиран заради нашата инварианта.
    1. A[j] >= A[j-1]. Инвариантата ни гарантира, че A[1..j-1] и А[j..i] са сортирани.
    Тъй като те представляват целия масив А то той е сортиран също.

## Доказателство чрез инварианта за for цикъла

Искаме да докажем, че след терминация A[1..A.lenght] е сортиран.

Инварианта:
    А[1..j-1] е сортиран след всяка итерация на цикъла

Инициализация:

    Преди първата итерация на цикъла i = 2 следователно масива A[1..1] е тривиално сортиран.

Поддръжка:

    Нека предположим, че А[1..i-1] е сортиран. Използвайки доказателството за while
    цикъла знаем, че елементът A[i] ще бъде вмъкнат в правилната позиция в A[1..i].
    Следователно след инкрементация на i А[1..i-1] продължава да бъде сортиран.

Терминация:

    Цикълът ще терминира при i = (A.lenght + 1). Използвайки нашата инварианта, знаем, че
    А[1..i] е сортиран, следователно целият масив А е сортиран.